<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <link rel="stylesheet" type="text/css" href="../../static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/Hui-iconfont/1.0.9/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/skin/default/skin.css" />
    <link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/css/style.css" />

    <title>用户账号列表</title>
</head>

<body class="pos-r">
    <nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 用户管理 <span class="c-gray en">&gt;</span> 账号管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px"
           href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a></nav>
    <div class="cl pd-5 bg-1 bk-gray mt-20 lh-30">
        <span class="r mr-20">
            <select name="s-type" id="s-type">
                <option value="MONTH">近一个月</option>
                <option value="YEAR">今年</option>
            </select>
        </span>
    </div>
    <div id="charts-container" class="chart-style" style="height: 400px; margin-top: 50px;"></div>
</body>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="../../lib/jquery/jquery-2.2.4.min.js"></script>
<script type="text/javascript" src="../../lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../../static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="../../static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="../../static/qyml/js/request.js"></script>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script src="../../lib/hcharts/highcharts.js"></script>
<script src="../../lib/hcharts/highcharts-zh_CN.js"></script>
<script src="../../lib/hcharts/exporting.js"></script>
<script type="text/javascript">
    getChartsData('MONTH');
    $('#s-type').change(function () {
        let value = $(this).val();
        // 获取渲染数据
        getChartsData(value);
    });

    // 获取渲染数据
    function getChartsData(sType) {
        request('/admin/api/admin/analysis/user', { sType: sType }, 400).then(res => {
            // 获取X轴数据
            let xData = initXData(sType);
            let seriesData = res.data;
            // 渲染数据
            initCharts({ xData: xData, seriesData: seriesData });
        }).catch(error => {
            console.log(error);
            layer.msg(error.toString(), { icon: 2, time: 1300 });
        })
    }

    // 渲染X轴数据
    function initXData(sType) {
        let xData = [];
        if (sType == "MONTH") {
            let date = Date.parse(new Date());
            for (let i = 0; i < 30; i++) {
                xData.unshift(formatMonth(date - i * 86400 * 1000));
            }
        } else if (sType == "YEAR") {
            for (let i = 0; i < 12; i++) {
                var date = new Date();
                date.setMonth(date.getMonth() - i);
                let curMonth = date.getMonth() + 1;
                curMonth = curMonth < 10 ? ('0' + curMonth) : curMonth;
                xData.unshift(date.getFullYear() + '-' + curMonth);
            }
        }
        return xData;
    }

    // 时间字符串格式化
    function formatMonth(date) {
        let curDate = new Date();
        curDate.setTime(date);
        return curDate.getFullYear() + '-' + (curDate.getMonth() + 1) + '-' + curDate.getDate();
    }

    // 渲染图表数据
    function initCharts(data) {
        var chart = Highcharts.chart('charts-container', {
            title: {
                text: '新增会员折线图'
            },
            xAxis: {
                categories: data.xData
            },
            yAxis: {
                allowDecimals: false,
                title: {
                    text: '新增人数'
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },
            series: data.seriesData,
            credits: {
                enabled: false // 禁用版权信息
            },
            plotOptions: {
                line: {
                    dataLabels: {
                        // 开启数据标签
                        enabled: true
                    }
                }
            },
            tooltip: {
                headerFormat: '日期: {point.x} <br>',
                pointFormat: '{point.series.name}：{point.y} 人<br>',
                shared: true
            },
        });
    }
</script>

</html>