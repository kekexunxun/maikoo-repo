
<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="Bookmark" href="/favicon.ico" >
    <link rel="Shortcut Icon" href="/favicon.ico" />
    <!--[if lt IE 9]>
    <script type="text/javascript" src="__ROOT__/public/static/lib/html5shiv.js"></script>
    <script type="text/javascript" src="__ROOT__/public/static/lib/respond.min.js"></script>

    <![endif]-->
    <link rel="stylesheet" type="text/css" href="__ROOT__/public/static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/public/static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/public/static/lib/Hui-iconfont/1.0.8/iconfont.css" />

    <link rel="stylesheet" type="text/css" href="__ROOT__/public/static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/public/static/h-ui.admin/css/style.css" />
    <!--[if IE 6]>
    <script type="text/javascript" src="__ROOT__/public/static/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <!--/meta 作为公共模版分离出去-->
</head>
<body>
<div class="page-container">
    <form action="" method="post" class="form form-horizontal" id="form-clicksetadd-add">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">选择分类：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <select  name="click_catagory" id="click_catagory" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
                    <option value="0">选择指定的小程序</option>
                    <option value="1">选择分类</option>
                    <option value="2">全部小程序</option>
                </select>
            </div>
        </div>

        <div class="row cl is_active">
            <label class="form-label col-xs-4 col-sm-2">选择小程序：</label>
            <div class="formControls col-xs-8 col-sm-9">
            {if condition="sizeof($miniprodata) == 0"}
            <select  name="clickset" id="clickset" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
                <option class="miniproname"></option>
            {else /}
            <select  name="clickset" id="clickset" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
            {volist name="$miniprodata" id="vol"}
                <option value="{$vol.mini_id}">{$vol.name}</option>
            {/volist}
            </select>
            {/if}    
            </div>  
        </div>

        <div class="row cl is_active" style="display: none;">
            <label class="form-label col-xs-4 col-sm-2">小程序分类：</label>
            <div class="formControls col-xs-8 col-sm-9">
            {if condition="sizeof($catagorydata) == 0"}
            <select  name="catagory" id="catagory" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
                <option></option>
            {else /}
            <select  name="catagory" id="catagory" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
            {volist name="$catagorydata" id="vol"}
                <option value="{$vol.catagory_id}">{$vol.name}</option>
            {/volist}
            </select>
            {/if}    
            </div>  
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">选择日期：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" name="countTimestart" id="countTimestart" onfocus="selecttime(1)" value="" size="31" readonly="" style="font-size: 14px;height: 30px;line-height: 1.42857;border: solid 1px #ddd; text-align: center;">                    
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">选择点击详情：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <select  name="clickset_detail" id="clickset_detail" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
                    <option value="0">详情页</option>
                    <option value="1">跳转</option>
                    <option value="2">全部</option>
                </select>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">选择是否开启：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <select  name="clickset_enable" id="clickset_enable" style="font-size: 14px; height: 31px;line-height: 1.42857;padding: 4px;float: left;">
                    <option value="1">开启</option>
                    <option value="0">不开启</option>
                </select>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">自定义点击量：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input style="width: 300px;" type="text" class="input-text" value="" placeholder="请输入正整数" id="clickset_num" maxlength="11" name="clickset_num" onkeyup="this.value=this.value.replace(/\D/g,'')">
            </div>
        </div>

        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                <a onClick="clicksetadd_save_submit();" class="btn btn-primary radius" href="javascript:;"><i class="Hui-iconfont">&#xe632;</i> 保存</a>
                <button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
            </div>
        </div>
    </form>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__ROOT__/public/static/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="__ROOT__/public/static/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__ROOT__/public/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__ROOT__/public/static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="__ROOT__/public/static/lib/My97DatePicker/4.8/WdatePicker.js"></script> 
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript">
    // 设置时间选择器的时间范围
    function selecttime(flag){
        var myDate = new Date();    
        var year = myDate.getFullYear();   //获取完整的年份(4位,1970-????)
        var month = myDate.getMonth()+1;   //获取当前月份(1-12)
        var day = myDate.getDate();        //获取当前日(1-31)
        //获取完整年月日
        var newDay = year + "-" + month + "-" + day;
        var minDate = year + "-" + (month-3) + "-" + day;
        if(flag==1){
            var endTime = $("#countTimeend").val();
            if(!endTime){
                WdatePicker({dateFmt:'yyyy-MM-dd', maxDate: newDay, minDate: minDate})
            }else{
                WdatePicker({dateFmt:'yyyy-MM-dd', maxDate: endTime, minDate: minDate})
            }
        }else{
            var startTime = $("#countTimestart").val();
            if(startTime != "" || !startTime){
                WdatePicker({dateFmt:'yyyy-MM-dd', minDate: minDate, maxDate: newDay})
            }else{
                WdatePicker({dateFmt:'yyyy-MM-dd', minDate: minDate, maxDate: newDay})
            }
        }
    }

    // 选择分类
    $('#click_catagory').change(function(event){
        if($('#click_catagory').val()==0){
            $('.is_active').eq(0).show();
            $('.is_active').eq(1).hide();
        }
        if($('#click_catagory').val()==1){
            $('.is_active').eq(0).hide();
            $('.is_active').eq(1).show();
        }
        if($('#click_catagory').val()==2){
            $('.is_active').eq(0).hide();
            $('.is_active').eq(1).hide();
        }        
    });
    // 提交表单信息
    function clicksetadd_save_submit() {
        // 日期非空
          if($('#countTimestart').val()==''){
            layer.msg('时间不能为空！',{icon:2,time:1000});
            return false;
        }      
        // 自定义点击量非空
        if($('#clickset_num').val()==''){
            layer.msg('自定义点击量不能为空！',{icon:2,time:1000});
            return false;
        }
        // console.log($('#click_catagory').val());
        if($('#click_catagory').val()==0){
            var num = 0;
            var mini_id = $('#clickset option:selected').val();
            var clickset_time = $('#countTimestart').val();
            var clickset_enable = $('#clickset_enable option:selected').val();
            var clickset_num = $('#clickset_num').val();      
            var clickset_detail = $('#clickset_detail').val();      
        }
        if($('#click_catagory').val()==1){
            var num = 1;
            var mini_id = $('#catagory option:selected').val();
            var clickset_time = $('#countTimestart').val();
            var clickset_enable = $('#clickset_enable option:selected').val();
            var clickset_num = $('#clickset_num').val();
            var clickset_detail = $('#clickset_detail').val();            
        }        
        if($('#click_catagory').val()==2){
            var num = 2;
            var mini_id = 0;
            var clickset_time = $('#countTimestart').val();
            var clickset_enable = $('#clickset_enable option:selected').val();
            var clickset_num = $('#clickset_num').val();
            var clickset_detail = $('#clickset_detail').val();            
        }
        $.ajax({
            type: 'POST',
            url: 'addClickset',
            dataType: 'json',
            data: {mini_id:mini_id,clickset_num:clickset_num,clickset_detail:clickset_detail,clickset_enable:clickset_enable,num:num,clickset_time:clickset_time},
            success: function(data){
                if(data.code=="200"){
                    layer.msg(data.msg,{icon:1,time:1000});
                    index = parent.layer.getFrameIndex(window.name);
                    setTimeout('parent.layer.close(index);',1000);
                }
                if(data.code=='300'){
                    layer.msg(data.msg,{icon:2,time:1000});
                }
            },
            error:function() {
                layer.msg('网络错误，请稍后重试！',{icon:2,time:1000});
            },
        });
    }   
</script>
</body>
</html>