<!DOCTYPE HTML>
<html>
    <head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit|ie-comp|ie-stand"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <!--[if lt IE 9]>
        <script type="text/javascript" src="__ROOT__/public/static/lib/html5shiv.js"></script>
        <script type="text/javascript" src="__ROOT__/public/static/lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="__ROOT__/static/lib/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/static/lib/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/static/lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/static/lib/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="__ROOT__/static/lib/h-ui.admin/css/style.css" />
    <style>
    </style>
    <title>库存管理界面</title>
    </head>
<body>
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 营销管理 <span class="c-gray en">&gt;</span> 库存管理 </nav>
	<div class="page-container">
        <div class="cl pd-5 bg-1 bk-gray mt-20">
            <span class="l">
                <a class="btn btn-primary radius" onClick="storeGoodsAdd()" href="javascript:;">
                    <i class="Hui-iconfont">&#xe600;</i>
                    添加店铺商品
                </a>
            </span>
            <span class="r">
                共有数据：
                <strong>{:sizeof($data)}</strong>
                条
            </span>
        </div>
        <div class="mt-20">
            <table class="table table-border table-bordered table-hover table-bg table-sort">
                <thead>
                <tr class="text-c">
                    <th width="30">商品编号</th>
                    <th width="30">商品名称</th>
                    <th width="100">商品图片</th>
                    <th width="50">创建时间</th>
                    <th width="50">更新时间</th>
                    <th width="30">商品库存</th>
                </tr>
                </thead>
                <tbody>
                    {if condition="sizeof($data) == 0"}
                    {else /}
                    {foreach name="$data" key="k" item="v"}
                    <tr class="text-c">
                        <td>{$v.goods_sn}</td>
                        <td>{$v.goods_name}</td>  
                        <td><img style="width:100px;height:100;" src="{$v.goods_img}"/></td>
                        <td>{$v.created_at}</td>
                        <td>{$v.update_at}</td>
                        <td class="td-status">
                            <span onclick="editStock(this,'{$v.idx}','{$v.stock}')" class="label label-warning radius" title="点击修改库存" style="cursor:pointer;">
                                {$v.stock}
                            </span>
                        </td>
                    </tr>
                    {/foreach}
                    {/if}
                </tbody>
            </table>
        </div>
    </div>
    <div id="modal-demotwo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content radius">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <span id="h3-span-name"></span>
                    </h3>
                    <span>修改商品库存</span>
                    <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
                </div>
                <div class="modal-body">
                    <!-- <p>对话框内容…</p> -->
                <form action="" method="post" class="form form-horizontal" id="form-stock-change">
                    <input id="idx" type="hidden" name="idx" value="" />
                    <div class="row cl active merchantlist-div" id="pause_reason_div">
                        <label class="form-label col-xs-4 col-sm-3">
                            <span class="c-red">*</span>
                            库存：
                        </label>
                        <div class="formControls col-xs-6 col-sm-6">
                            <input style="width: 200px;" type="text" class="input-text valid" autocomplete="off" onkeyup="wordLimit(this)" id="stock" value="" placeholder="库存" name="stock"/>
                        </div>
                    </div>
                    <input id="submit_input" type='submit' value="提交" style="display:none;"/>
                </form> 
                </div>
                <div class="modal-footer">
                    <button id="change" class="btn btn-primary" onclick="sendEditStock()">
                        保存
                    </button>
                    <button class="btn" data-dismiss="modal" aria-hidden="true">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer mt-20">
        <div class="container">
            <p>Powered By 福建麦口信息科技有限公司</p>
        </div>
    </footer>
</body>
</html>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__ROOT__/static/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="__ROOT__/static/lib/layer/layer.js"></script>
<script type="text/javascript" src="__ROOT__/static/lib/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__ROOT__/static/lib/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer 作为公共模版分离出去-->
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__ROOT__/static/lib/datatables/1.10.16/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="__ROOT__/static/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="__ROOT__/static/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="__ROOT__/static/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript">
    function sendEditStock(){
        $('#submit_input').click();
    }
    //表单提交
    $("#form-stock-change").validate({
        rules: {
            stock : {
                required:true,
                maxlength:13,
                number:true,
                range:[0,999999],
            },
        },
        onkeyup:false,
        success:"valid",
        submitHandler:function(form){
            layer.confirm('确定修改吗?',function(){
                $(form).ajaxSubmit({
                    type : 'POST',
                    url  : '/index/promotion/stockedit',
                    typeData : 'JSON',
                    success : function (result){
                        if( result.code < 400 ){
                            layer.alert(result.msg,{icon:1,closeBtn:0},function(){
                                window.location.href = window.location.href;
                            });
                        }else{
                            layer.alert(result.msg);
                        }
                    },
                    error : function(){
                        layer.alert('请求失败!');
                    }
                });
            });
        }
    });
    /*字数限制*/
    function wordLimit(obj){
        var value = $(obj).val();
        if( value.length > 13 ){
            value = value.substring(0,13);
            $(obj).val(value);
        }
    }
    /**
     * 商品添加
     */
    function storeGoodsAdd()
    {
        var index = layer.open({
            type: 2,
            title: '添加优惠券',
            content: '/index/promotion/storegoods',
            end: function(){
                location.replace(location.href);
            }
        });
        layer.full(index);
    }
    /**
     * 修改商品库存
     */
    function editStock(obj,idx,stock)
    {   
        $('#stock').val(stock);
        $('#idx').val(idx);
        var merchantName = $(obj).parent().parent().find('td:nth-child(2)').html();
        $('#h3-span-name').html(merchantName);
        $("#modal-demotwo").modal("show");
    }
</script>